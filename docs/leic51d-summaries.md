# LEIC51D Summaries

## Lesson 1 - 2022-09-13

- Course presentation
    - [_Ficha de Unidade Curricular_](https://www.isel.pt/sites/default/files/FUC_LEIC/5sem/DAW_LEIC.pdf)
    - Moodle pages
        - [Course](https://2223moodle.isel.pt/course/view.php?id=6303) ("unidade curricular")
        - [Course section](https://2223moodle.isel.pt/course/view.php?id=6307) ("turma")
    - [Github repository](https://github.com/isel-leic-daw/s2223i-51d-51n-public)
        - [docs](https://github.com/isel-leic-daw/s2223i-51d-51n-public/tree/main/docs)
            - [calendar](https://github.com/isel-leic-daw/s2223i-51d-51n-public/blob/main/docs/calendar.md)
            - [evaluation](https://github.com/isel-leic-daw/s2223i-51d-51n-public/blob/main/docs/evaluation.md)
            - [resource](https://github.com/isel-leic-daw/s2223i-51d-51n-public/blob/main/docs/resources.md)

- Inversion of Control, Dependency Injection and the Spring Context library
    - Class stereotypes.
        - Containers of functionality (components) vs containers of data.
    - Dependency relations between _dependents_ and a _ dependencies_.
        - Instance of component `A` requires a instance of component `B` to operate, `A` depends on `B`.
    - Inversion of Control (IoC).
        - `A` does not create instances of `B`. Instead, `A` receives (is injected with) instances of `B`, created outside the `A` control.
    - Dependency Injection (DI).
        - The mechanism by which a dependent receives its dependencies.
        - **Constructor injection** - dependencies are passed in as constructor arguments and stored on immutable fields.
            - The preferable way of dependency injection.
        - **Field or property injection** - dependencies are passed in **after** object creation, via the assignment of fields or the executions of property setter methods.
            - Requires mutable dependency fields.
            - Objects are not ready to operate after construction.
            - Use only when constructor injection is not possible.
    - Object composition.
        - Components instance and their dependency relations define a graph.
        - Creating this graph can be done by:
            - Manually defined code.
            - Automatically, by using a DI container.
    - Spring Context is a DI container.
        - Given a set of **type** information, including their dependencies, it creates the graph of component **instances**.
        - See the `example-spring-context` project on the course repository.
    - Container independence.
        - The component design should be independent of the the container usage.
    - Spring Framework documentation
        - [https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#spring-core]
        - [https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config]

## Lesson 2 - 2022-09-15

- The Servlet specification.
    - Allow request handlers (servlets) and intermediaries (filters) to run on multiple web servers, the so called servlet containers.
    - [Jakarta Specifications](https://jakarta.ee/specifications/servlet/).
    - Servlet
        - Final handler for an HTTP request.
        - Methods that receive
            - An `HttpServletRequest` representing the request information.
            - An `HttpServletResponse` with the response information produced so far.
    - Filter
        - Intermediary that can perform:
            - Pre-processing, before the request-response pair is passed in to the next intermediary or final handler.
            - Post-processinf, after the next intermediary or final handler returned
            - Short-circuit the request processing, by not calling the next intermediary or final handler.
    - See the `example-servlets` project on the course repository.

- Spring Boot
    - [Spring Initializr](https://start.spring.io)
        - [Example](https://start.spring.io/#!type=gradle-project&language=kotlin&platformVersion=2.7.3&packaging=jar&jvmVersion=17&groupId=com.example&artifactId=demo&name=demo&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.demo&dependencies=web)
    - Analysis of the project generated by [Spring Initializr](https://start.spring.io)
        - Typical Gradle-based JVM project.
        - Included libraries - Spring, Jackson, and Kotlin.
        - Included gradle plugins.
        - `main` function and the `@SpringBootApplication` _application class_.
    - Adding HTTP request handling.
        - _handler_ - method that procudes _response information_ based on _request information_
            - Typically defined as an instance function (i.e. method) **without** a predefined type signature.
            - With additional metadata provided as annotations, to associate it to HTTP request methods and URI path templates.
        - _controller_ - a container of handlers.

## Lesson 3 - 2022-09-20

- Spring MVC (Model-View-Controller)
    - [Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#spring-web)
    - Servlet-based architecture
        - Single [`DispatcherServlet`](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-servlet) mapped to all paths.
        - Servlet container initialization and servlet mapping is done by Spring Boot.
        - This pattern is sometimes named [_front controller_](https://www.martinfowler.com/eaaCatalog/frontController.html).
        - `HttpServletRequest` and `HttpServletResponse` are the base for all request and response interaction.
        - It is possible to use filters (defined according to the servlet interface).
    - Argument resolution (see `ArgumentResolutionExamplesController`).
        - From path template variables.
        - From request parameters (i.e. query string parameters).
        - From the request body using model binding.
        - From the servlet request and response objects.
        - Using custom argument resolvers.
            - See `ClientIpExampleArgumentResolver`.
    - Response message production (see `MessageConversionExamplesController`)
        - From primitive types.
        - Using `ResponseEntity` to control other parts of the message, such as the status code and the headers.
        - From complex types, using messsage converts
            - Jackson-based message converter.
            - Creating custom message converters (see `UriToQrCodeMessageConverter`).
    - Configuration via the `WebMvcConfigurer` interface.
    - Intercepting requests via filters and handler interceptors.
        - Differences on the programming models and capabilities.
        - The `HttpServletRequest` attributes bag.

## Lesson 4 - 2022-09-22

- Introduction to HTTP API design
    - Characterization of APIs
        - On one end
            - Single client.
            - High coordination between client and HTTP API.
                - Easy to add and coordinate changes on both the client and the API.
            - Short-lived: months.
            - Data-oriented.
                - Provides data for clients to use on their own ways
        - On the other end (not really the end)
            - Multiple clients.
            - Dificult to coordinate changes on both the clients and the APIs
            - Long-lived: years, decades.
            - Journey-oriented (process-oriented).
                - Exposes functionality for clients to provide very well defined journeys/processes
    - Introduction to the use of hypermedia as a way to reduce coupling between the client and a specific HTTP API implementation.
        - Analysis of a concrete HTTP API.

## Lesson 5 - 2022-09-27

- System architecture for the DAW project
    - Backend service component and frontend client component.
    - Responsabilities of each component.
        - Backend service is responsible to ensure data integrity, namely that all domain rules are correctly enforced.
            - Data integrity and domain rule enforcement does not depend on the correct behaviour of the frontend application.
                - However correctness of the frontend application is required to ensure all operations correctly reflect user behavior.
        - Frontend client component is resposible for the user interaction.
    - Interaction between frontend applications and backend service done via an HTTP API, provided by the backend service.
        - HTTP API follows a request-response messaging pattern, at least during the first phase
            - The communication initiative is always on the API's client, i.e., the frontend application.
            - The backend service only communicates information to the frontend service in the context of an HTTP response.
            - Implies polling by the frontend application to check for asynchronous state changes.

- Backend service architecture
    - A Postgres DBMS, holding all the relevant system state, such as users, games, and boards. 
    - One or more servers, running a JVM-based application, hosting the HTTP request handling logic, domain logic, and interaction with the DBMS.
    - A load-balancer, exposing the publicly accessible network endpoint with the HTTP API, and forwarding the requests to one of the servers.
    - A consequence of this load-balancing based architecture is that the servers need to be mostly stateless.
        - Do not hold system state, such as users and games.
        - Only hold configuration and inter-request processing state.

- Server architecture
    - Use of the Spring framework.
    - HTTP processing pipeline with intermediaries containing common processing.
        E.g. authentication token handling, handler argument resolving.
    - Handlers, defined in controllers, resposible for the specific HTTP request handling.
    - Services, used by handlers with the domain logic.
        - Services are independent of the interface being an HTTP API (i.e. they don't know anything about HTTP).
        - Services are independent of the persistence interface (i.e. they don't know anything about relational databases or JDBC).
    - Repositories, responsible for data persistence and retrieval.

- Designing the interactions between handlers, services, and repositories.
    - Defining the transaction boundaries and associated design options.
    - Using Thread Local Storage as a way to associate transaction information to each request without the need to explicitly passing it via arguments through all the layers.

## Lesson 6 - 2022-09-29

- Continuation of the previous lesson.
- The Spring context request scope has a way to associate managed beans to HTTP requests.

## Lesson 7 - 2022-10-11

- Web architecture review [https://www.w3.org/TR/webarch/](https://www.w3.org/TR/webarch/)
    - Web as an information space where the items of interest are _resources_.
    - Resource identification via _Uniform Resource Identifiers_ (URI).
        - _Universility_ property of URIs
    - Interaction between agents and resources via _interaction protocols_, such as HTTP.
    - Use of formats to represent state, namely resource state.
        - Media-types as identifiers for formats.
        - Use of links in representations as a way to relate resources in the information space.

- The HTTP protocol.
    - Request and response messages.
    - Message semantics vs. network communication mechanisms.
        - Message semantics is almost unchaged since HTTP/1.1.
        - Network communication mechanisms have changed between HTTP/1.1 and HTTP/3.
            - The evolution has been on a better usage of the network and not on a change to the messaging semantics.
                - Multiple simultaneous request and responses on the same connection.
                - Binary encodings of messages.
    - General method semantics.
        - Safe methods and idempotent methods.
    - Specific method semantics.
        - `GET` semantics.
        - `PUT` semantics.
        - `POST` semantics.
        - How to use RFCs to obtain further information.
        - Additional reading: ["Should I PUT or should I POST"](https://labs.pedrofelix.org/notes/http/should-i-put-or-should-i-post)
    - Request headers, response headers and content headers.
        - Way to provide extra information about the request, the response, or the message content (i.e. payload).
        - Headers typically contain domain-independent information (e.g. GitHub's rate limit headers).

- The HTTP protocol.
    - Response message status codes.
    - How to inform about failure
        - Status codes. 
        - Representations
            - ["RFC 7807 - Problem Details for HTTP APIs"](https://www.rfc-editor.org/rfc/rfc7807)
                - Standard members of a _Problem Details_ JSON object.
                - Extension members and their relation to the standard `type` field.
        - Additional reading: 
            - Additional reading: 
                - ["How to fail in HTTP APIs"](https://labs.pedrofelix.org/notes/http/how-to-fail)
                - ["How to think about HTTP Status Codes"](https://www.mnot.net/blog/2017/05/11/status_codes)
                - ["Indicating problems in HTTP APIs](https://www.mnot.net/blog/2013/05/15/http_problem)

- Representation design.

    - [JSON Hypertext Application Language](https://datatracker.ietf.org/doc/html/draft-kelly-json-hal) - draft
        - Links represented in the special `_links` field.
            - `_links` is an object where the field names are relation types and the values is a link object or an array of link objects.
            - A link object has: `href`, `templated`, `type`, ...
        - _Embedded resources_ represented in the special `_embedded` field.
        - No support for representing actions, i.e., non-safe interactions.
    
    - [Siren: a hypermedia specification for representing entities](https://github.com/kevinswiber/siren)
        - Main ideas:
            - Including the actions representations in resource representations (on HAL-FORMS, these actions are their own resources).
            - Grouping the non-link resource properties in a `properties` field.
            - The concept of `class`.
    

## Lesson 8 - 2022-10-13

- Continuation of the previous lesson.

## Lesson 9 - 2022-10-18

- Laboratory class, supporting the project development.

## Lesson 10 - 2022-10-20

- Laboratory class, supporting the project development.

## Lesson 11 - 2022-10-25

- HTTP intermediaries
    - From [https://www.rfc-editor.org/rfc/rfc9110#name-intermediaries](https://www.rfc-editor.org/rfc/rfc9110#name-intermediaries)
    > "HTTP enables the use of intermediaries to satisfy requests through a chain of connections. There are three common forms of HTTP "intermediary": proxy, gateway, and tunnel"
        
    >"A "gateway" (a.k.a. "reverse proxy") is an intermediary that acts as an origin server for the outbound connection but translates received requests and forwards them inbound to another server or servers. Gateways are often used to encapsulate legacy or untrusted information services, to improve server performance through "accelerator" caching, and to enable partitioning or load balancing of HTTP services across multiple machines"

    >"A "tunnel" acts as a blind relay between two connections without changing the messages. Once active, a tunnel is not considered a party to the HTTP communication, though the tunnel might have been initiated by an HTTP request. A tunnel ceases to exist when both ends of the relayed connection are closed. Tunnels are used to extend a virtual connection through an intermediary, such as when Transport Layer Security (TLS, [TLS13]) is used to establish confidential communication through a shared firewall proxy"

    - The [NGINX Reverse Proxy](https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/)
        - [Controlling NGINX Processes at Runtime](https://docs.nginx.com/nginx/admin-guide/basic-functionality/runtime-control/)
        - [Configuration Files](https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/)
        - [Load Balancing](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/)
        - [proxy_next_upstream](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream)

    - Analysis of a scenario using NGINX for load-balancing, based on docker compose
        - [https://github.com/isel-leic-daw/s2223i-51d-51n-public/pull/11](https://github.com/isel-leic-daw/s2223i-51d-51n-public/pull/11)

- Handling exceptions on Spring MVC
    - The _controller advice_ concept.
    - Using exceptions vs. return types.

- Testing strategies for Spring MVC based applications.
    - Unit tests without using the Spring context.
    - Integration tests using the HTTP interface and an auto-started application.
    - Tests using the Spring context, with bean overriding or bean mocking.
        - Property injections.

- Complementary notes on media type design

    - [JSON:API](https://jsonapi.org/)

    - [HAL-FORMS](https://rwcbook.github.io/hal-forms/) - draft
            - Main idea:
                - HAL representation contains links to resources that represent non-safe interactions.
                    - Obtaining such a resource is a safe-interaction, performed via a `GET` request.
                - HAL-FORM representation contains information on how to perform a non-safe interaction.
                    - Very similar in objective to HTML forms.
    

## Lesson 12 - 2022-10-27

- Continuation of the previous lesson.

(National Holiday on Tuesday)

## Lesson 13 - 2022-11-03

- Phase 1 project presentations.

## Lesson 14 - 2022-11-08

- The Browser as an application execution platform.
    - Document loading.
    - JavaScript loading and execution environment.
        - Immediate execution versys deferred execution.
        - Loading of multiple JavaScript files.
            - Behaviour without using a module system.
                - Single namespace for all the top-level symbols in the file.
                    - Clashing between symbols
            - Behaviour using the [ECMAScript Modules](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)
                - Using `<script src="..." type="module"></script>`.
                - Importing a module from another module using the `import` statement.
                    - Individual requests for each module.
                    - Single execution of the module top-level code.
                - One HTTP request per imported module.
                    - An applicaition can have many modules, both created for the application or from used libraries.
                    - A module is a mechanism to organize and isolate code. We should not need to reduce the module count for efficiency purposes.
                    - Solution: bundling multiple _source_ modules into a single (or few) _load_ level modules. I.e. the source code module organization is not the same as the browser-loaded module organization.
                        - This means that now there is a build process required, since the JavaScript source files are not same as the JavaScript files provided to the browser.
            - Creating the build process.
                - Create an NPM project
                    - Why:
                        - To have a build automation tool.
                        - To run node-based tools, such as the "bundler"
                        - to include third-party libraries available on NPM
                    - `npm init`
                    - `npm install webpack-cli --save-dev`
                        - `webpack-cli` is a Command Line Interface (CLI) application to do the bundling
                        - `--save-dev` to save the dependency on `package.json` as a development dependency, i.e., a dependency used to develop/build the project and not to run the result of the project.
                    - Set `package.json` `scripts/build` to call `webpack`.
                - Copy source files to the `src` folder (by default webpack uses that as the JavaScript files location).
                - Rename the entry point module to `index.js` (again, it's the default webpack assumption).
                - Run `npm run build` to run the `build` script, which calls the `webpack` CLI tool.
                    - This will create a `dist` folder with the bundle file, called `main.js`.
                    - Change the `script` element to use `dist/main.js` and observe the result.
                    - Observe the `dist/main.js` contents and be marvelled.
                - Using third-party libraries
                    - Run `npm i urijs --save`
                    - Use `URITemplate` imported from 'urijs' in one of the modules.
                    - Observe the `dist/main.js` contents again.
                - Configuring the webpack behavior
                    - Create the `webpack.config.js` file.
                    ```
                    module.exports = {
                        mode: 'development'
                    }
                    ```
                    - Observe the `dist/main.js` contents yet again.
                - Automating the build and HTML serving process
                    - `npm i webpack-dev-server --save-dev`.
                    - Set `package.json` `scripts/start` to call `webpack serve`.
                    - `webpack serve` keeps running and
                        - Rebuilding the project when changes are detected.
                        - Serving the updated bundle.
                    - IMPORTANT: this is a development-time tool. In production, the bundled file will not be served using Webpack.

- The [TypeScript language](https://www.typescriptlang.org/)
    - JavaScript plus static type information.
    - Using in on our development workflow.
        - `npm i typescript ts-loader --save-dev`.
        - Edit `webpack.config.js` to configure a _loader_.
        - Create the file `tsconfig.json` to configure the TypeScript compilation.
    - The type information in the source files is *checked* and *erased* on the compiled files.
    - The type system
        - Primitive types.
        - Type annotations and inference.
        - Array types.
        - Function types.
        - Object types and type aliases.
        - Union types, type narrowing, literal types, and descriminated union types.
        
