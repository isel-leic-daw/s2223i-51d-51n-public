# LEIC51N Summaries

## Lesson 1 - 2022-09-12

- Course presentation
    - [_Ficha de Unidade Curricular_](https://www.isel.pt/sites/default/files/FUC_LEIC/5sem/DAW_LEIC.pdf)
    - Moodle pages
        - [Course](https://2223moodle.isel.pt/course/view.php?id=6303) ("unidade curricular")
        - [Course section](https://2223moodle.isel.pt/course/view.php?id=6307) ("turma")
    - [Github repository](https://github.com/isel-leic-daw/s2223i-51d-51n-public)
        - [docs](https://github.com/isel-leic-daw/s2223i-51d-51n-public/tree/main/docs)
            - [calendar](https://github.com/isel-leic-daw/s2223i-51d-51n-public/blob/main/docs/calendar.md)
            - [evaluation](https://github.com/isel-leic-daw/s2223i-51d-51n-public/blob/main/docs/evaluation.md)
            - [resource](https://github.com/isel-leic-daw/s2223i-51d-51n-public/blob/main/docs/resources.md)

## Lesson 2 - 2022-09-15

- Inversion of Control, Dependency Injection and the Spring Context library
    - Class stereotypes.
        - Containers of functionality (components) vs containers of data.
    - Dependency relations between _dependents_ and a _ dependencies_.
        - Instance of component `A` requires a instance of component `B` to operate, `A` depends on `B`.
    - Inversion of Control (IoC).
        - `A` does not create instances of `B`. Instead, `A` receives (is injected with) instances of `B`, created outside the `A` control.
    - Dependency Injection (DI).
        - The mechanism by which a dependent receives its dependencies.
        - **Constructor injection** - dependencies are passed in as constructor arguments and stored on immutable fields.
            - The preferable way of dependency injection.
        - **Field or property injection** - dependencies are passed in **after** object creation, via the assignment of fields or the executions of property setter methods.
            - Requires mutable dependency fields.
            - Objects are not ready to operate after construction.
            - Use only when constructor injection is not possible.
    - Object composition.
        - Components instance and their dependency relations define a graph.
        - Creating this graph can be done by:
            - Manually defined code.
            - Automatically, by using a DI container.
    - Spring Context is a DI container.
        - Given a set of **type** information, including their dependencies, it creates the graph of component **instances**.
        - See the `example-spring-context` project on the course repository.
    - Container independence.
        - The component design should be independent of the the container usage.
     - Spring Framework documentation
        - [https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#spring-core]
        - [https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config]

- The Servlet specification.
    - Allow request handlers (servlets) and intermediaries (filters) to run on multiple web servers, the so called servlet containers.
    - [Jakarta Specifications](https://jakarta.ee/specifications/servlet/).
    - Servlet
        - Final handler for an HTTP request.
        - Methods that receive
            - An `HttpServletRequest` representing the request information.
            - An `HttpServletResponse` with the response information produced so far.
    - Filter
        - Intermediary that can perform:
            - Pre-processing, before the request-response pair is passed in to the next intermediary or final handler.
            - Post-processinf, after the next intermediary or final handler returned
            - Short-circuit the request processing, by not calling the next intermediary or final handler.
    - See the `example-servlets` project on the course repository.

- Spring Boot
    - [Spring Initializr](https://start.spring.io)
        - [Example](https://start.spring.io/#!type=gradle-project&language=kotlin&platformVersion=2.7.3&packaging=jar&jvmVersion=17&groupId=com.example&artifactId=demo&name=demo&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.demo&dependencies=web)
    - Analysis of the project generated by [Spring Initializr](https://start.spring.io)
        - Typical Gradle-based JVM project.
        - Included libraries - Spring, Jackson, and Kotlin.
        - Included gradle plugins.
        - `main` function and the `@SpringBootApplication` _application class_.
    - Adding HTTP request handling.
        - _handler_ - method that procudes _response information_ based on _request information_
            - Typically defined as an instance function (i.e. method) **without** a predefined type signature.
            - With additional metadata provided as annotations, to associate it to HTTP request methods and URI path templates.
        - _controller_ - a container of handlers.

## Lesson 3 - 2022-09-19

- Spring MVC (Model-View-Controller)
    - [Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#spring-web)
    - Servlet-based architecture
        - Single [`DispatcherServlet`](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-servlet) mapped to all paths.
        - Servlet container initialization and servlet mapping is done by Spring Boot.
        - This pattern is sometimes named [_front controller_](https://www.martinfowler.com/eaaCatalog/frontController.html).
        - `HttpServletRequest` and `HttpServletResponse` are the base for all request and response interaction.
        - It is possible to use filters (defined according to the servlet interface).
    - Argument resolution (see `ArgumentResolutionExamplesController`).
        - From path template variables.
        - From request parameters (i.e. query string parameters).
        - From the request body using model binding.
        - From the servlet request and response objects.
        - Using custom argument resolvers.
            - See `ClientIpExampleArgumentResolver`.

## Lesson 4 - 2022-09-22
 
- Spring MVC (cont.)
    - Response message production (see `MessageConversionExamplesController`)
        - From primitive types.
        - Using `ResponseEntity` to control other parts of the message, such as the status code and the headers.
        - From complex types, using messsage converts
            - Jackson-based message converter.
            - Creating custom message converters (see `UriToQrCodeMessageConverter`).
    - Configuration via the `WebMvcConfigurer` interface.
    - Intercepting requests via filters and handler interceptors.
        - Differences on the programming models and capabilities.
        - The `HttpServletRequest` attributes bag.

- Introduction to HTTP API design
    - Characterization of APIs
        - On one end
            - Single client.
            - High coordination between client and HTTP API.
                - Easy to add and coordinate changes on both the client and the API.
            - Short-lived: months.
            - Data-oriented.
                - Provides data for clients to use on their own ways
        - On the other end (not really the end)
            - Multiple clients.
            - Dificult to coordinate changes on both the clients and the APIs
            - Long-lived: years, decades.
            - Journey-oriented (process-oriented).
                - Exposes functionality for clients to provide very well defined journeys/processes
    - Introduction to the use of hypermedia as a way to reduce coupling between the client and a specific HTTP API implementation.
        - Analysis of a concrete HTTP API.

## Lesson 5 - 2022-09-26

- System architecture for the DAW project
    - Backend service component and frontend client component.
    - Responsabilities of each component.
        - Backend service is responsible to ensure data integrity, namely that all domain rules are correctly enforced.
            - Data integrity and domain rule enforcement does not depend on the correct behaviour of the frontend application.
                - However correctness of the frontend application is required to ensure all operations correctly reflect user behavior.
        - Frontend client component is resposible for the user interaction.
    - Interaction between frontend applications and backend service done via an HTTP API, provided by the backend service.
        - HTTP API follows a request-response messaging pattern, at least during the first phase
            - The communication initiative is always on the API's client, i.e., the frontend application.
            - The backend service only communicates information to the frontend service in the context of an HTTP response.
            - Implies polling by the frontend application to check for asynchronous state changes.

- Backend service architecture
    - A Postgres DBMS, holding all the relevant system state, such as users, games, and boards. 
    - One or more servers, running a JVM-based application, hosting the HTTP request handling logic, domain logic, and interaction with the DBMS.
    - A load-balancer, exposing the publicly accessible network endpoint with the HTTP API, and forwarding the requests to one of the servers.
    - A consequence of this load-balancing based architecture is that the servers need to be mostly stateless.
        - Do not hold system state, such as users and games.
        - Only hold configuration and inter-request processing state.

## Lesson 6 - 2022-09-29

- Server architecture
    - Use of the Spring framework.
    - HTTP processing pipeline with intermediaries containing common processing.
        E.g. authentication token handling, handler argument resolving.
    - Handlers, defined in controllers, resposible for the specific HTTP request handling.
    - Services, used by handlers with the domain logic.
        - Services are independent of the interface being an HTTP API (i.e. they don't know anything about HTTP).
        - Services are independent of the persistence interface (i.e. they don't know anything about relational databases or JDBC).
    - Repositories, responsible for data persistence and retrieval.

- Designing the interactions between handlers, services, and repositories.
    - Defining the transaction boundaries and associated design options.
    - Using Thread Local Storage as a way to associate transaction information to each request without the need to explicitly passing it via arguments through all the layers.

- The Spring context request scope has a way to associate managed beans to HTTP requests.

## Lesson 7 - 2022-10-03

- Web architecture review [https://www.w3.org/TR/webarch/](https://www.w3.org/TR/webarch/)
    - Web as an information space where the items of interest are _resources_.
    - Resource identification via _Uniform Resource Identifiers_ (URI).
        - _Universility_ property of URIs
    - Interaction between agents and resources via _interaction protocols_, such as HTTP.
    - Use of formats to represent state, namely resource state.
        - Media-types as identifiers for formats.
        - Use of links in representations as a way to relate resources in the information space.

- The HTTP protocol.
    - Request and response messages.
    - Message semantics vs. network communication mechanisms.
        - Message semantics is almost unchaged since HTTP/1.1.
        - Network communication mechanisms have changed between HTTP/1.1 and HTTP/3.
            - The evolution has been on a better usage of the network and not on a change to the messaging semantics.
                - Multiple simultaneous request and responses on the same connection.
                - Binary encodings of messages.
    - General method semantics.
        - Safe methods and idempotent methods.
    - Specific method semantics.
        - `GET` semantics.
        - `PUT` semantics.
        - `POST` semantics.
        - How to use RFCs to obtain further information.
        - Additional reading: ["Should I PUT or should I POST"](https://labs.pedrofelix.org/notes/http/should-i-put-or-should-i-post)
    - Request headers, response headers and content headers.
        - Way to provide extra information about the request, the response, or the message content (i.e. payload).
        - Headers typically contain domain-independent information (e.g. GitHub's rate limit headers).

## Lesson 8 - 2022-10-10 (planned)

- The HTTP protocol.
    - Response message status codes.
    - How to inform about failure
        - Status codes. 
        - Representations
            - ["RFC 7807 - Problem Details for HTTP APIs"](https://www.rfc-editor.org/rfc/rfc7807)
                - Standard members of a _Problem Details_ JSON object.
                - Extension members and their relation to the standard `type` field.
        - Additional reading: 
            - Additional reading: 
                - ["How to fail in HTTP APIs"](https://labs.pedrofelix.org/notes/http/how-to-fail)
                - ["How to think about HTTP Status Codes"](https://www.mnot.net/blog/2017/05/11/status_codes)
                - ["Indicating problems in HTTP APIs](https://www.mnot.net/blog/2013/05/15/http_problem)

- Representation design.

    - [JSON Hypertext Application Language](https://datatracker.ietf.org/doc/html/draft-kelly-json-hal) - draft
        - Links represented in the special `_links` field.
            - `_links` is an object where the field names are relation types and the values is a link object or an array of link objects.
            - A link object has: `href`, `templated`, `type`, ...
        - _Embedded resources_ represented in the special `_embedded` field.
        - No support for representing actions, i.e., non-safe interactions.

    - [HAL-FORMS](https://datatracker.ietf.org/doc/html/draft-kelly-json-hal) - draft
        - Main idea:
            - HAL representation contains links to resources that represent non-safe interactions.
                - Obtaining such a resource is a safe-interaction, performed via a `GET` request.
            - HAL-FORM representation contains information on how to perform a non-safe interaction.
                - Very similar in objective to HTML forms.
    
    - [Siren: a hypermedia specification for representing entities](https://github.com/kevinswiber/siren)
        - Main ideas:
            - Including the actions representations in resource representations (on HAL-FORMS, these actions are their own resources).
            - Grouping the non-link resource properties in a `properties` field.
            - The concept of `class`.
    
    - [JSON:API](https://jsonapi.org/)

## Lesson 9 - 2022-10-13 (planned)

- Continuation of the previous lesson.